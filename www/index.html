<!doctype html>

<html lang="en">
<head>
<!--	<meta http-equiv="refresh" content="0; url=http://skilladda.com" />	-->
	<link rel="stylesheet" type="text/css" href="css/index.css" />
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/index.js"></script>
	<script type="text/javascript" src="js/push.js"></script>
</head>
<body>
	<div id="html">
		<div id="loading">
			<img id="loading-image" src="skilladda_logo_black.png" alt="SkillAdda" />
			<div class="error_msg" id="message"></div><br><br>
			<div id="app_id" style="display:none;"></div>
			<div id="app_device" style="display:none;"></div>
		</div>	
	</div>
	<script type="text/javascript">
		document.addEventListener("deviceready", onDeviceReady, false);

		// device APIs are available
		function initialize() { 
			this.bindEvents(); 
		}

		function bindEvents() { 
			document.addEventListener('deviceready', this.onDeviceReady, false); 
		}
		function onDeviceReady() {
			var  networkConnectionType =  navigator.network.connection.type;
			var element = document.getElementById('message');
			var log = document.getElementById('log_msg');
			element.innerHTML = '';
			if(networkConnectionType=='none'){
				element.innerHTML = 'Please connect to your internet connection and try again!';
			}
			else{
				element.innerHTML = '<a target="_blank" onClick=goToUrl();>Go to SkillAdda</a>';
			}
			gcm_initialize();
		}
		var pushNotification;

		function successHandler (result) {
		}
		function errorHandler (error) {
		}

		function onNotificationGCM(e) {
			switch( e.event )
			{
				case 'registered':
					if ( e.regid.length > 0 )
					{
						console.log('REGISTERED -> REGID:' + e.regid );
						document.getElementById('app_id').innerHTML = e.regid;
						document.getElementById('app_device').innerHTML = device.platform;
					}
					break;
				case 'message':
					console.log('gcm: on message ');
					break;

				case 'error':
					console.log( "gcm error: "+e.msg );
					break;
				default:
					break;
			}
		}

		function gcm_initialize() {
			document.addEventListener("deviceready", function(){
				pushNotification = window.plugins.pushNotification;
				if ( device.platform == 'android' || device.platform == 'Android' || device.platform == "amazon-fireos" ){
					try {
						pushNotification.register(
							successHandler, errorHandler, { "senderID":"50957485970", "ecb":"onNotificationGCM" });
					} catch(err)
					{
						txt="There was an error on this page.\n\n";
						txt+="Error description: " + err.message + "\n\n";
					}
				}

			});
		}
		function goToUrl(){
			var  networkConnectionType =  navigator.network.connection.type;
		//	alert('Connection Type: ' +  networkConnectionType );
			if(networkConnectionType=='none'){
				var element = document.getElementById('message');
			//	element.setAttribute('href','#');
				element.innerHTML = 'Please connect to your internet connection and try again!';
				return false;
			}
			else{
				var app_id = document.getElementById('app_id').innerHTML;
				var app_device = device.platform;
				window.open('http://www.skilladda.xucorelms.com?app_id='+app_id+'&app_device='+app_device,'_self','location=no','hidden=yes','clearsessioncache=yes','toolbar=no','clearcache=yes','fullscreen=yes','hardwareback=no');
				return false;
			}
		}
	</script>			
</body>
</html>
